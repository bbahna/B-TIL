## **âœï¸ ì˜¤ëŠ˜ì˜ í•œ ì¼**

- ì†Œì…œ(ì¹´ì¹´ì˜¤) ë¡œê·¸ì¸ êµ¬í˜„
- ìë™ íšŒì›ê°€ì… ì„¤ì •

## **ğŸŒˆ ì˜¤ëŠ˜ì˜ ì„±ì¥**

- ì²« ì†Œì…œ ë¡œê·¸ì¸ ì—°ë™ ğŸ¥³
- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ê³¼ì • ì´í•´ [[link](https://developers.kakao.com/docs/latest/ko/kakaologin/common)]

<br>

## **â› ì˜¤ëŠ˜ì˜ ì‚½ì§ˆ**

1. passport-kakao ì—°ë™

ì„¤ì •ê°’ì„ ì˜ëª» ì…ë ¥í•´ì„œ í•œì°¸ ì‚½ì§ˆì„ í–ˆë‹¤.

> ì°¸ê³ : ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì—ëŸ¬ ì´ìŠˆ ì§ˆë¬¸ (ê´€ë¦¬ì ì„¤ì • ì´ìŠˆ (koe101))[[link](https://devtalk.kakao.com/t/koe101/111440)]

```ts
// kakao.strategy.ts

@Injectable()
export class KakaoStrategy extends PassportStrategy(Strategy, 'kakao') {
  constructor(private configService: ConfigService) {
    super({
      clientID: configService.get('KAKAO_CLIENT_ID'), // ì•± í‚¤(REST API í‚¤)
      clientSecret: configService.get<string>('KAKAO_CLIENT_SECRET'), // OpenID Connect í™œì„±í™” ì„¤ì •í•œ ê²½ìš°, Client Secret í‚¤
      callbackURL: configService.get<string>('KAKAO_CALLBACK_URL'), // OAuth Redirect URL
      scope: ['account_email', 'profile_nickname'],
    });
  }

  async validate((accessToken: string, refreshToken: string, profile: any) {
    return profile
  };
}
```

2.  ì´ˆê¸° ë°ì´í„° seed êµ¬í˜„

í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©í•  ë”ë¯¸ ë°ì´í„° ì‚½ì…ì„ ëª©ì ìœ¼ë¡œ ì•Œì•„ë´¤ë‹¤. TypeORM ê³µì‹ë¬¸ì„œì—ì„œ [ì¶”ì²œ](https://typeorm.io/#extensions)í•˜ëŠ” ëª¨ë“ˆ([typeorm-extension](https://github.com/tada5hi/typeorm-extension))ì„ ì„¤ì¹˜í•´ì„œ ì‘ì—…í•´ë´¤ë‹¤.
ë°ì´í„°ë² ì´ìŠ¤ë¥¼ [ì‚­ì œ](https://github.com/tada5hi/typeorm-extension#drop)í•˜ê³ , [ìƒì„±](https://github.com/tada5hi/typeorm-extension#create)í•˜ê³ , ì´ˆê¸° ë°ì´í„°ë¥¼ [ì‚½ì…](https://github.com/tada5hi/typeorm-extension#seeding)í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí–ˆë‹¤.
í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©í•˜ë ¤ë©´, ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ê¸°ëŠ¥ì„ ì°¾ìœ¼ë ¤ê³  í•œì°¸ ì‚½ì§ˆí–ˆë‹¤.

ë°ì´í„°ë¥¼ ì‚½ì…í•˜ëŠ” seederë¥¼ jest(beforeEach)ì— ë„£ì–´ë³´ë ¤ê³  í–ˆëŠ”ë°, ì´ˆê¸° ì‹¤í–‰ì—ì„œë§Œ ë™ì‘í•˜ë”ë¼.
ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í–ˆì„ë•ŒëŠ” ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê²ƒìœ¼ë¡œ ë´ì„œëŠ” seederì˜ ë¬¸ì œë¼ê¸° ë³´ë‹¤ëŠ”, dataSourceë¥¼ ì¤‘ë³µìœ¼ë¡œ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ëŠ”ê²Œ ì•„ë‹Œê°€ ì‹¶ë‹¤.

```ts
// src/database/seeds/user.seed.ts
// ì´ ê²½ë¡œê°€ typeorm-extension seedì˜ ê¸°ë³¸ ê²½ë¡œ
export default class UserSeeder implements Seeder {
  async run(dataSource: DataSource, factoryManager: SeederFactoryManager): Promise<any> {
    const repository = dataSource.getRepository(User);
    await repository.clear(); // ë°ì´í„° ì´ˆê¸°í™”
    await repository.insert([
      // ë°ì´í„° ì‚½ì…
      {
        userId: "cat1",
        password: "meow",
      },
    ]);
  }
}

// user.service.spec.ts
describe("UserService", () => {
  beforeEach(async () => {
    dataSource = module.get<DataSource>(DataSource);
    await runSeeders(dataSource); // ğŸ’¥ ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì—ì„œ ì¤‘ë³µìœ¼ë¡œ seed ë˜ì§€ ì•ŠìŒ
  });

  it("ë°ì´í„°ê°€ ì¡°íšŒë¨", async () => {
    // í…ŒìŠ¤íŠ¸
  });
});
```

ê²°êµ­ ì§ì ‘ dataSource ë¥¼ ê°€ì ¸ë‹¤ê°€ ì´ìš©í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ìš°íšŒí–ˆë‹¤.

```ts
// user.service.spec.ts
describe("UserService", () => {
  beforeEach(async () => {
    await dataSource.getRepository(User).clear();
  });

  it("ë°ì´í„°ê°€ ì¡°íšŒë¨", async () => {
    // í…ŒìŠ¤íŠ¸
  });
});
```

<br>

## **â˜•ï¸ íšŒê³ **

ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì€ open api ì—¬ì„œ ë¬¸ì„œê°€ ì—„ì²­ ì˜ ë˜ì–´ìˆì–´ì„œ, ì˜ë„ëŒ€ë¡œ êµ¬í˜„ì„ í•œê±´ê°€? í•˜ëŠ” ì˜ë¬¸ì€ ì—†ì—ˆë‹¤. ìƒˆì‚¼ ë¦¬ìŠ¤í™

ì¼ì¼ì´ ë¡œì§ êµ¬í˜„í•˜ì§€ ì•Šìœ¼ë ¤ê³  ì°¾ë‹¤ê°€, typeorm-extensionë¥¼ ë„ì…í•˜ê²Œ ë˜ì—ˆëŠ”ë°, ì‚¬ìš© ë°©ë²•ì„ ì´í•´í•˜ëŠ”ë° ì‚½ì§ˆì˜ ì‹œê°„ì´ ë“¤ì—ˆë‹¤.
ì²˜ìŒë¶€í„° êµ¬í˜„í•˜ë©´, íš¨ìœ¨ì€ ë–¨ì–´ì§€ê² ì§€ë§Œ, ì •í™•íˆ ì˜ë„ëŒ€ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤ëŠ” ê²ƒì„ ë˜ ìƒˆì‚¼ ëŠê¼ˆë‹¤.

íšŒì‚¬ì—ì„œëŠ” ë¦¬ìŠ¤í¬ë¥¼ ì¤„ì´ê¸° ìœ„í•´ ìµìˆ™í•œ ë„êµ¬ë¥¼ í™œìš©í•˜ëŠ” ë°©ì‹ì„ ë§ì´ ì‚¬ìš©í–ˆì—ˆëŠ”ë°, ì´ë²ˆ ê¸°íšŒì— ì²´ê°í•  ìˆ˜ ìˆì–´ì„œ ì˜ë¯¸ìˆì—ˆë‹¤.
